#!/usr/bin/env bash

font_name="$1"

if [[ -n "$font_name" && "$font_name" != "CNCLD" ]]; then
  if fc-list | grep -iq "$font_name"; then
    if [[ -f "$XDG_CONFIG_HOME/alacritty/alacritty.toml" ]]; then
      sed -i "s/family = \".*\"/family = \"$font_name\"/g" "$XDG_CONFIG_HOME/alacritty/alacritty.toml"
    fi

    if [[ -f "$XDG_CONFIG_HOME/kitty/kitty.conf" ]]; then
      sed -i "s/^font_family .*/font_family $font_name/g" "$XDG_CONFIG_HOME/kitty/kitty.conf"
      pkill -USR1 kitty
    fi

    if [[ -f "$XDG_CONFIG_HOME/ghostty/config" ]]; then
      sed -i "s/font-family = \".*\"/font-family = \"$font_name\"/g" "$XDG_CONFIG_HOME/ghostty/config"
      pkill -SIGUSR2 ghostty
    fi

    sed -i "s/font-family: .*/font-family: '$font_name';/g" "$XDG_CONFIG_HOME/waybar/style.css"
    sed -i "s/font-family: .*/font-family: '$font_name';/g" "$XDG_CONFIG_HOME/swayosd/style.css"
    xmlstarlet ed -L \
      -u '//match[@target="pattern"][test/string="monospace"]/edit[@name="family"]/string' \
      -v "$font_name" \
      "$XDG_CONFIG_HOME/fontconfig/fonts.conf"

    script-restart-waybar
    script-restart-swayosd
    script-restart-walker

    script-hook font-set "$font_name"
  else
    echo "Font '$font_name' not found."
    exit 1
  fi
else
  echo "Usage: script-font-set <font-name>"
fi
