#!/usr/bin/env bash

source "$(dirname "$0")"/monitors_info.sh

# Exit early if we don't have the tte show
if ! [[ "$(command -v tte)" ]]; then
  exit 1
fi

# Exit early if screensaver is already running
[[ "$(pgrep -f "alacritty --class Screensaver")" ]] && exit 0

# Allow screensaver to be turned off but also force started
if [[ -f "$DOT_STATE_DIR/toggles/screensaver-off" ]] && [[ $1 != "force" ]]; then
  exit 1
fi

for m in "${all_monitors[@]}"; do
  focus_monitor "$m"

  # FIXME: Find a way to make this generic where we it can work for kitty + ghostty
  spawn_cmd_screensaver \
    alacritty --class Screensaver \
    --config-file "$XDG_CONFIG_HOME/alacritty/screensaver.toml" \
    -e script-cmd-screensaver
done

focus_monitor "$focused_monitor"
